<html>
<head></head>
<body>

<div id="pieChart"></div>

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.js"></script> 
<script src="http://geotime.tw.rpi.edu/js/jquery-1.7.2.min.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/d3/3.4.4/d3.min.js"></script>
<script src="js/d3pie.min.js"></script>
<script>
	$(document).ready(function() {

//Displays a pie chart showing DCO members sorted by affiliated DCO community
//Uses D3 and sample code from d3pie.org
//Author Stephen Moon
//Version 7/23/2015

var commNumbers = [];

$.ajax({ 
	dataType: "json",
	url: 'https://info.deepcarbon.net/vivo/admin/sparqlquery?query=PREFIX+rdfs%3A++%3Chttp%3A%2F%2Fwww.w3.org%2F2000%2F01%2Frdf-schema%23%3E%0D%0APREFIX+dco%3A+%3Chttp%3A%2F%2Finfo.deepcarbon.net%2Fschema%23%3E%0D%0APREFIX+foaf%3A+%3Chttp%3A%2F%2Fxmlns.com%2Ffoaf%2F0.1%2F%3E%0D%0A%0D%0A%23This+query+gets+the+names+of+each+DCO+community+and+counts+the+number+of+users+in+%0D%0A%23each+community%0D%0ASELECT+%3Fdcocommname+%28COUNT%28%3Fuser%29+as+%3Fnumber%29+WHERE%0D%0A%7B%0D%0A%3Fuser+a+foaf%3APerson%3B%0D%0A+++++++++%3Chttp%3A%2F%2Fvivo.mydomain.edu%2Fns%23networkId%3E+%3FnetID%3B%0D%0A+++++++++dco%3AassociatedDCOCommunity+%3Fdcocomm.%0D%0A%3Fdcocomm+rdfs%3Alabel+%3Fdcocommname.%0D%0A%7D%0D%0AGROUP+BY+%3Fdcocommname&resultFormat=RS_JSON&rdfResultFormat=RDF%2FXML-ABBREV',
	success: function(data) {     
		for(var i = 0; i < data.results.bindings.length; i++)
		{
			updateNumbers(parseInt(data.results.bindings[i].number.value));
		}

		var pie = generateChart(commNumbers);

	} 
});


function updateNumbers(number) {
	commNumbers.push(number);
};

function generateChart(commNumbers) {
	return new d3pie("pieChart", {
		"header": {
			"title": {
				"text": "Members Sorted by Affiliated Community",
				"fontSize": 24,
				"font": "open sans"
			},
			"subtitle": {
				"text": "Deep Carbon Observatory",
				"color": "#999999",
				"fontSize": 16,
				"font": "open sans"
			},
			"titleSubtitlePadding": 9
		},
		"footer": {
			"color": "#999999",
			"fontSize": 10,
			"font": "open sans",
			"location": "bottom-left"
		},
		"size": {
			"canvasWidth": 590,
			"pieInnerRadius": "35%",
			"pieOuterRadius": "90%"
		},
		"data": {
			"sortOrder": "label-asc",
			"content": [
			{
				"label": "Reservoirs and Fluxes",
				"value": commNumbers[0],
				"color": "#0c6197"
			},
			{
				"label": "Data Science",
				"value": commNumbers[1],
				"color": "#248838"
			},
			{
				"label": "Deep Life",
				"value": commNumbers[2],
				"color": "#e98125"
			},
			{
				"label": "Extreme Physics and Chemistry",
				"value": commNumbers[3],
				"color": "#923e99"
			},
			{
				"label": "Deep Energy",
				"value": commNumbers[4],
				"color": "#00fbe4"
			},
			{
				"label": "Engagement Team",
				"value": commNumbers[5],
				"color": "#eb0ddc"
			},
			{
				"label": "DCO Secretariat",
				"value": commNumbers[6],
				"color": "#f3f10b"
			}
			]
		},
		"labels": {
			"outer": {
				"pieDistance": 32
			},
			"inner": {
				"hideWhenLessThanPercentage": 3
			},
			"mainLabel": {
				"fontSize": 11
			},
			"percentage": {
				"color": "#ffffff",
				"decimalPlaces": 1
			},
			"value": {
				"color": "#adadad",
				"fontSize": 11
			},
			"lines": {
				"enabled": true
			},
			"truncation": {
				"enabled": true
			}
		},
		"effects": {
			"pullOutSegmentOnClick": {
				"effect": "linear",
				"speed": 400,
				"size": 16
			}
		},
		"misc": {
			"gradient": {
				"enabled": true,
				"percentage": 100
			}
		}
	});

};

}); 
</script>

</body>
</html>
